(self["webpackChunk_coreui_coreui_free_vue_admin_template"]=self["webpackChunk_coreui_coreui_free_vue_admin_template"]||[]).push([[869],{4234:function(t){let e={year:"numeric",month:"long",day:"numeric"};t.exports={dateFormatter:t=>new Date(t).toLocaleDateString("ru-RU",e),getAgeStr(t){return t>12?`${Math.trunc(t/12)} лет ${t%12} месяцев`:`${t} месяцев`}}},9869:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return W}});var o=a(3396);function i(t,e,a,i,r,l){const s=(0,o.up)("AddPostModal"),d=(0,o.up)("Table");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(s,{visible:r.formVisible,formData:r.formData,mode:t.formMode},null,8,["visible","formData","mode"]),(0,o.Wm)(d,{fields:r.tableFieldNames,postData:l.get,actions:r.dataActions,rows:r.rows,editMode:"form",name:"Посты"},null,8,["fields","postData","actions","rows"])])}var r=a(9242),l=a(7139);function s(t,e,a,i,s,d){const n=(0,o.up)("CButton"),m=(0,o.up)("CModalTitle"),u=(0,o.up)("CModalHeader"),p=(0,o.up)("CFormInput"),c=(0,o.up)("CFormTextarea"),h=(0,o.up)("CModalBody"),f=(0,o.up)("CModalFooter"),g=(0,o.up)("CForm"),w=(0,o.up)("CModal");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(n,{color:"primary",onClick:d.addNewPost},{default:(0,o.w5)((()=>[(0,o.Uk)("Добавить пост")])),_:1},8,["onClick"]),(0,o.Wm)(w,{size:"xl",backdrop:"static",alignment:"center",visible:a.visible,onClose:d.closeModal},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{novalidate:"",validated:s.formValid,ref:"add-file-form",onChange:t.wregert,onSubmit:e[2]||(e[2]=(0,r.iM)((t=>"new"===a.mode?d.addNewing():d.editNewing()),["prevent"])),class:"add-user",style:{display:"'none'"}},{default:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)("new"===a.mode?"Добавить пост":"Редактировать пост"),1)])),_:1})])),_:1}),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,{class:"mb-3",modelValue:a.formData.title,"onUpdate:modelValue":e[0]||(e[0]=t=>a.formData.title=t),placeholder:"Заголовок",id:"inputHeader","aria-describedby":"inputGroupPrepend",feedbackValid:"Все ок",maxlength:"255",feedbackInvalid:"Введите корректный заголовок",required:""},null,8,["modelValue"]),(0,o.Wm)(c,{style:(0,l.j5)([{display:"md2"===s.textEditMode?"block":"none"},{"margin-bottom":"1rem"}]),modelValue:s.textMd2,"onUpdate:modelValue":e[1]||(e[1]=t=>s.textMd2=t),label:"Текст статьи",placeholder:"Напишите что-нибудь",rows:"20",id:"inputText","aria-describedby":"inputGroupPrepend",required:""},null,8,["style","modelValue"])])),_:1}),(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o.Wm)(n,{color:"secondary",onClick:d.closeModal},{default:(0,o.w5)((()=>[(0,o.Uk)(" Отменить ")])),_:1},8,["onClick"]),(0,o.wy)((0,o.Wm)(n,{color:"primary",type:"submit"},{default:(0,o.w5)((()=>[(0,o.Uk)("Добавить пост")])),_:1},512),[[r.F8,"new"===a.mode]]),(0,o.wy)((0,o.Wm)(n,{color:"primary",type:"submit"},{default:(0,o.w5)((()=>[(0,o.Uk)("Редактировать пост")])),_:1},512),[[r.F8,"edit"===a.mode]])])),_:1})])),_:1},8,["validated","onChange"])])),_:1},8,["visible","onClose"])],64)}var d=a(6265),n=a.n(d),m=a(7123);const u=n().create({withCredentials:!0});var p={components:{},props:{mode:{required:!0,type:String,validator:t=>["new","edit"].includes(t.toLowerCase())},visible:!1,formData:{title:"",text:"",description:"",preview_name:"",tags_array:new Set}},data(){return{textMd2:"",textEditMode:"md2",formValid:!1,preview:""}},updated(){this.textMd2=this.formData.text,document.getElementsByClassName("ql-toolbar")?.[0].classList.add("hidden")},async mounted(){},methods:{addNewPost(){m.Z.$emit("addNewPost")},changeP(t){console.log(t.target.value),this.formData.project_name=t.target.value},changeT(t){console.log(t.target.checked),t.target.checked?this.formData.tags_array.add(t.target.value):this.formData.tags_array.delete(t.target.value)},closeModal(){m.Z.$emit("closeModal")},constractFromData(t){if(!this.formData.title||!this.textMd2)throw new Error;var e=new FormData;return e.append("title",this.formData.title),e.append("text",this.textMd2),t&&e.append("id",this.formData.id),e},addNewing(){console.log(this.$refs.postTextEditor.getHTML());try{const t=this.constractFromData();u.post(this.$store.state.publicPath+"/api/admin/posts",t,{headers:{"Content-Type":"multipart/form-data"}}).then((()=>{m.Z.$emit("postAdded")})).catch((t=>{m.Z.$emit("noresponse",t)}))}catch(t){this.formValid=!0}},editNewing(){try{const t=this.constractFromData(!0);u.put(this.$store.state.publicPath+"/api/admin/posts",t,{headers:{"Content-Type":"multipart/form-data"}}).then((()=>{m.Z.$emit("postEdited")})).catch((t=>{m.Z.$emit("noresponse",t)}))}catch(t){this.formValid=!0}}}},c=a(89);const h=(0,c.Z)(p,[["render",s],["__scopeId","data-v-34bdc2b3"]]);var f=h;const g={key:1},w={class:"d-grid gap-2 d-md-flex justify-content-md-center"};function _(t,e,a,i,r,s){const d=(0,o.up)("CCardHeader"),n=(0,o.up)("CTableHeaderCell"),m=(0,o.up)("CTableRow"),u=(0,o.up)("CTableHead"),p=(0,o.up)("CFormInput"),c=(0,o.up)("CTableDataCell"),h=(0,o.up)("CButton"),f=(0,o.up)("CTableBody"),_=(0,o.up)("CTable"),b=(0,o.up)("CCardBody"),C=(0,o.up)("CCard"),y=(0,o.up)("CCol"),D=(0,o.up)("CRow"),k=(0,o.up)("CPaginationItem"),v=(0,o.up)("CPagination");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(D,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,{md:12},{default:(0,o.w5)((()=>[(0,o.Wm)(C,{class:"mb-4"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.name),1)])),_:1}),(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(_,{align:"middle",class:"mb-0 border",hover:"",responsive:""},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{color:"light"},{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.fieldNames,(t=>((0,o.wg)(),(0,o.j4)(n,{key:t+"header",class:"text-center"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(t),1)])),_:2},1024)))),128)),(0,o.Wm)(n,{class:"text-center"},{default:(0,o.w5)((()=>[(0,o.Uk)("Действия")])),_:1})])),_:1})])),_:1}),(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.transformData(a.rows),((i,d)=>((0,o.wg)(),(0,o.j4)(m,{key:d+"row"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i,((t,e)=>((0,o.wg)(),(0,o.j4)(c,{key:e+"row",class:"text-center"},{default:(0,o.w5)((()=>[r.updatingId===a.rows[d]?.id?((0,o.wg)(),(0,o.j4)(p,{key:0,modelValue:r.formData[a.fields[e]?.name],"onUpdate:modelValue":t=>r.formData[a.fields[e]?.name]=t},null,8,["modelValue","onUpdate:modelValue"])):((0,o.wg)(),(0,o.iD)("span",g,(0,l.zw)(t),1))])),_:2},1024)))),128)),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o._)("div",w,[r.updatingId===a.rows[d]?.id?((0,o.wg)(),(0,o.j4)(h,{key:0,color:"primary",size:"md",onClick:t=>s.editRow(d)},{default:(0,o.w5)((()=>[(0,o.Uk)(" Сохранить")])),_:2},1032,["onClick"])):(0,o.kq)("",!0),r.updatingId===a.rows[d]?.id?((0,o.wg)(),(0,o.j4)(h,{key:1,color:"light",size:"md",onClick:e[0]||(e[0]=t=>r.updatingId=!1)},{default:(0,o.w5)((()=>[(0,o.Uk)(" Отменить")])),_:1})):((0,o.wg)(!0),(0,o.iD)(o.HY,{key:2},(0,o.Ko)(a.actions,((e,a)=>((0,o.wg)(),(0,o.j4)(h,{key:a+"action",color:e?.color,size:"sm",onClick:o=>s.chooseAction(a,e,d,t.j,t.column)},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a),1)])),_:2},1032,["color","onClick"])))),128))])])),_:2},1024)])),_:2},1024)))),128)),(0,o.Wm)(m)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),(0,o.Wm)(v,{"aria-label":"Page navigation example"},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{onClick:s.previousPage},{default:(0,o.w5)((()=>[(0,o.Uk)("Назад")])),_:1},8,["onClick"]),(0,o.Wm)(k,{disabled:""},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(r.page),1)])),_:1}),(0,o.Wm)(k,{onClick:s.nextPage},{default:(0,o.w5)((()=>[(0,o.Uk)("Далее")])),_:1},8,["onClick"])])),_:1})],64)}a(7658);var b=a(4234),C={props:{name:{type:String},fields:[],actions:[],rows:[],postData:{type:Function,default:()=>{}},updateRow:{type:Function,default:()=>{}},editMode:{type:String,default:"inline"}},data(){return{fieldNames:[],perPage:10,page:1,updatingId:!1,formData:{}}},async mounted(){this.fieldNames=this.fields.map((t=>"object"===typeof t?t.title??t.name:t)),await this.postData(this.perPage,this.page)},methods:{dateFormatter:b.dateFormatter,chooseAction(t,e,a){e&&(console.log("Изменить"===t&&"inline"===this.editMode,a),"Изменить"===t&&"inline"===this.editMode?(this.updatingId=this.rows[a]?.id,this.formData=this.rows[a]):e?.action(this.rows[a]))},async nextPage(){const t=await this.postData(this.perPage,this.page+1);t?.length>0&&this.page++},previousPage(){this.page>1&&this.page--,this.postData(this.perPage,this.page)},toPage(t){this.page=t,this.postData(this.perPage,this.page)},editRow(t){this.updatingId=!1,this.updateRow(this.rows[t]?.id,this.formData)},transformData(t){return t?.map(this.transformDataEl)},transformDataEl(t){let e=[];for(let a of this.fields){const o=a.name.split(".")??a.split(".");let i=t;o?.forEach((t=>i=i?.[t])),"publication_date"===a?.name&&(i=(0,b.dateFormatter)(i)),"text"===a?.name&&(i=i.substr(0,100)),e.push(i??"")}return e}}};const y=(0,c.Z)(C,[["render",_]]);var D=y;const k=n().create({withCredentials:!0,credentials:"include"});var v={name:"Posts",components:{AddPostModal:f,Table:D},props:["tag","project"],data(){return{myApi:k,formVisible:!1,formData:{},rows:[],dataActions:{"Изменить":{action:this.change,color:"warning"},"Удалить":{action:this.delete,color:"danger"}},tableFieldNames:[{name:"title",title:"Название"},{name:"publication_date",title:"Дата добавления"}]}},created(){m.Z.$on("addNewPost",(()=>{this.formMode="new",this.formData={project_name:this.$route.params.projectName,tags_array:this.$route.params.tag?new Set([this.$route.params.tag]):new Set},this.formVisible=!0})),m.Z.$on("closeModal",(()=>{this.formVisible=!1,this.formData={}})),m.Z.$on("postAdded",(()=>{this.formVisible=!1,this.get(),this.formData={}})),m.Z.$on("postEdited",(()=>{this.formVisible=!1,this.formData={}}))},methods:{change(t){this.formVisible=!0,t.tags_array=new Set(t.tags_array),this.formData=t,console.log(t),this.formMode="edit"},get(t,e){return console.log(this.tag),k.get(this.$store.state.publicPath+"/api/admin/posts/",{params:{take:t??10,page:e??1,tagsArray:this.$route.params.tag?[this.$route.params.tag]:void 0,projectName:this.$route.params.projectName}}).then((t=>(t.data?.length>0&&(this.rows=t.data),t.data))).catch((t=>(m.Z.$emit("noresponse",t),!1)))},delete(t){const e=confirm("Вы действительно хотите удалить пост?");if(e)return k.delete(this.$store.state.publicPath+"/api/admin/posts/",{data:{id:t.id}}).then((()=>{this.get(),m.Z.$emit("postDeleted")})).catch((t=>{m.Z.$emit("noresponse",t)}))}}};const M=(0,c.Z)(v,[["render",i]]);var W=M}}]);
//# sourceMappingURL=869.45fd3777.js.map